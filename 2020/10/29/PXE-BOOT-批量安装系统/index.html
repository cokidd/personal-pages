<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>PXE-BOOT-批量安装系统 | cokkid eat code</title><script src="https://cdn.bootcss.com/valine/1.4.4/Valine.min.js"></script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.1.2/styles/atom-one-dark-reasonable.min.css"><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 5.2.0"></head><body><header><nav><a href="/">Home</a><a href="/archives/">Archives</a></nav></header><main><article><div id="post-bg"><div id="post-title"><div id="post-info"><span>date:<time datetime="2020-10-29T02:03:44.000Z" id="date"> 2020-10-29</time></span><br><span>updated:<time datetime="2020-12-15T11:26:49.193Z" id="updated"> 2020-12-15</time></span></div><h1>PXE-BOOT-批量安装系统</h1><hr></div><div id="post-content"><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><h3 id="PXE"><a href="#PXE" class="headerlink" title="PXE"></a>PXE</h3><p>PXE （preboot execute environment,预启动执行环境），工作于Client/Server（C/S）的网络模式，支持工作通过远端服务器下载映像，并由此支持通过网络启动操作系统，在启动过程中，终端要求服务器分配IP地址，再用TFTP(trivial file transfer protocol) 或MTFTP(multicast trivial file transfer protocol)协议下载一个启动软件包到本机内存中执行，并由这个启动软件包完成终端（客户端）基本软件设置，从而引导预先安装在服务器中的终端操作系统。</p>
<h3 id="PXE工作过程"><a href="#PXE工作过程" class="headerlink" title="PXE工作过程"></a>PXE工作过程</h3><p>(1) PXE Client 设置PXE以启动项启动，Client向网络中DHCP服务器获取IP</p>
<p>(2) DHCP服务器返回分配给Client端IP和PXE文件的位置</p>
<p>(3) PXE Client 向网络中TFTP获取pxelinux.0文件</p>
<p>(4) PXE Client获取pxelinux.0文件后执行该文件</p>
<p>(5) 从服务器中加载内核和文件系统</p>
<p>(6) 进入安装界面</p>
<h3 id="PXE网络安装"><a href="#PXE网络安装" class="headerlink" title="PXE网络安装"></a>PXE网络安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum -y install syslinux xinetd tftp-server<br>mkdir /var/lib/tftpboot/pxelinux.cfg<br><span class="hljs-meta">#</span><span class="bash">pxelinux.0是引导驱动文件</span><br>cp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/<br></code></pre></td></tr></table></figure>

<p>设置网络守护进程服务程序&amp;&amp;FTP服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell">vi /etc/xinetd.d/tftp<br><br><span class="hljs-meta">#</span><span class="bash">设置守护tftp服务开启，默认为关闭。(未安装tftp服务,不存在当前文件)</span><br>disable = no<br>service tftp<br>&#123;<br>        socket_type             = dgram<br>        protocol                = udp<br>        wait                    = yes<br>        user                    = root<br>        server                  = /usr/sbin/in.tftpd<br>        server_args             = -s /var/lib/tftpboot &lt;-设置启动目录<br>        disable                 = yes &lt;- 设置为no<br>        per_source              = 11<br>        cps                     = 100 2<br>        flags                   = IPv4<br>&#125;<br><br>systemctl start xinetd<br>systemctl enable xinetd<br></code></pre></td></tr></table></figure>

<p>设置DHCP服务器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum -y install dhcp<br>vi /etc/dhcp/dhcp.conf<br><span class="hljs-meta">#</span><span class="bash">设置域名</span><br>option domain-name     &quot;&quot;;<br><span class="hljs-meta">#</span><span class="bash">设置DNS服务器</span><br>option domain-name-servers     ;<br><span class="hljs-meta">#</span><span class="bash">设置最小时间</span><br>default-lease-time 600;<br><span class="hljs-meta">#</span><span class="bash">设置最大时间</span><br>max-lease-time 7200;<br><span class="hljs-meta">#</span><span class="bash">设置为认证有效</span><br>authoritative;<br><span class="hljs-meta">#</span><span class="bash"> 设置子网ip地址区域，掩码</span><br>subnet 10.0.0.0 netmask 255.255.255.0 &#123;<br>    #设置ip分配区域<br>    range dynamic-bootp 10.0.0.200 10.0.0.254;<br>    #设置广播ip地址<br>    option broadcast-address 10.0.0.255;<br>    #设置网关<br>    option routers 10.0.0.1;<br>    #设置启动文件名<br>    filename        &quot;pxelinux.0&quot;;<br>    #设置获取tftp服务器IP地址也是pxelinux.0所在位置，也是镜像所在位置<br>    next-server     ;<br>&#125;<br><span class="hljs-meta">#</span><span class="bash">启动DHCP服务器</span><br>systemctl restart dhcpd<br></code></pre></td></tr></table></figure>

<p>挂载镜像到tftp服务器上</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">创建pxe文件夹</span><br>mkdir -p /var/pxe/centos7<br><span class="hljs-meta">#</span><span class="bash">创建tftp挂载文件夹</span><br>mkdir /var/lib/tftpboot/centos7<br><span class="hljs-meta">#</span><span class="bash">挂载镜像文件至pxe文件夹内</span><br>mount -t iso9660 -o loop /home/iso/CentOS-7-x86_64-DVD-1503-01.iso /var/pxe/centos7<br><span class="hljs-meta">#</span><span class="bash">将pxe所需内核和虚拟文件系统拷贝到tftpboot文件系统上</span><br>cp /var/pxe/centos7/images/pxeboot/vmlinuz /var/lib/tftpboot/centos7/<br>cp /var/pxe/centos7/images/pxeboot/initrd.img /var/lib/tftpboot/centos7/<br><span class="hljs-meta">#</span><span class="bash"> menu.c32是菜单显示类型</span><br>cp /usr/share/syslinux/menu.c32 /var/lib/tftpboot/<br>vi /var/lib/tftpboot/pxelinux.cfg/default<br><br><span class="hljs-meta">#</span><span class="bash"> create new</span><br>timeout 100<br>default menu.c32 &lt;-配置菜单显示类型<br><br>menu title ########## PXE Boot Menu ##########<br>label 1<br>   menu label ^1) Install CentOS 7<br>   kernel centos7/vmlinuz<br><span class="hljs-meta">   #</span><span class="bash">添加内核路径（添加http协议，实际镜像位置)</span><br>   append initrd=centos7/initrd.img method=http://10.0.0.30/centos7 devfs=nomount<br><br>label 2<br>   menu label ^2) Boot from local drive<br>   localboot<br></code></pre></td></tr></table></figure>

<p>配置httpd服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">vi /etc/httpd/conf.d/pxeboot.conf<br><span class="hljs-meta">#</span><span class="bash">设置镜像挂载的pxe文件夹位置，别名为\centos7</span><br>Alias /centos7 /var/pxe/centos7<br>&lt;Directory /var/pxe/centos7&gt;<br><span class="hljs-meta">	#</span><span class="bash">配置当前目录起到连接作用</span><br>	Options Indexes FollowSymlinks<br><span class="hljs-meta">	#</span><span class="bash">配置提供IP段地址</span><br>	Require ip 127.0.0.1 10.0.0.0/24<br>&lt;/Directory&gt;	<br>systemctl restart httpd<br><br></code></pre></td></tr></table></figure>

<h3 id="Kickstart自动安装"><a href="#Kickstart自动安装" class="headerlink" title="Kickstart自动安装"></a>Kickstart自动安装</h3><p>1.修改anaconda-ks.cfg或手动编辑xx-ks.cfg文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta"> #</span><span class="bash">生成root密码</span><br> python -c &#x27;import crypt,getpass; \<br>print(crypt.crypt(getpass.getpass(), \<br>crypt.mksalt(crypt.METHOD_SHA512)))&#x27;<br>password:<br><span class="hljs-meta">#</span><span class="bash">创建ks路径</span><br>mkdir /var/www/html/ks<br>vi /var/www/html/ks/centos7-ks.cfg<br><br><span class="hljs-meta">#</span><span class="bash">安装</span><br>install<br><span class="hljs-meta">#</span><span class="bash">自动执行每一步骤</span><br>autostep<br><span class="hljs-meta">#</span><span class="bash">安装后重启</span><br>reboot<br><span class="hljs-meta">#</span><span class="bash">加密算法</span><br>auth --enableshadow --passalgo=sha512<br><span class="hljs-meta">#</span><span class="bash">安装源地址</span><br>url --url=http://10.0.0.30/centos7/<br><span class="hljs-meta">#</span><span class="bash">安装盘名称</span><br>ignoredisk --only-use=sda<br><span class="hljs-meta">#</span><span class="bash">键盘布局</span><br>keyboard --vckeymap=jp106 --xlayouts=&#x27;jp&#x27;,&#x27;us&#x27;<br><span class="hljs-meta">#</span><span class="bash"> 系统本地化</span><br>lang en_US.UTF-8<br><span class="hljs-meta">#</span><span class="bash">网络设置</span><br>network --bootproto=dhcp --ipv6=auto --activate --hostname=localhost<br><span class="hljs-meta">#</span><span class="bash"> root密码（上方显示内容）</span><br>rootpw --iscrypted $6$EC1T.oKN5f3seb20$y1WlMQ7Ih424OwOn.....<br><span class="hljs-meta">#</span><span class="bash"> 时区</span><br>timezone Asia/Shanghai --isUtc --nontp<br><span class="hljs-meta">#</span><span class="bash"> 分区和引导方式</span><br>bootloader --location=mbr --boot-drive=sda<br><span class="hljs-meta">#</span><span class="bash"> 初始化分区</span><br>zerombr<br>clearpart --all --initlabel<br><span class="hljs-meta">#</span><span class="bash"> 分区大小</span><br>part /boot --fstype=&quot;xfs&quot; --ondisk=sda --size=500<br>part pv.10 --fstype=&quot;lvmpv&quot; --ondisk=sda --size=51200<br>volgroup VolGroup --pesize=4096 pv.10<br>logvol / --fstype=&quot;xfs&quot; --size=20480 --name=root --vgname=VolGroup<br>logvol swap --fstype=&quot;swap&quot; --size=4096 --name=swap --vgname=VolGroup<br><span class="hljs-meta">%</span><span class="bash">packages</span><br><span class="hljs-meta">#</span><span class="bash">基础计算机节点环境，也可以换成其他自由选择</span><br>@^compute-node-environment<br>@base<br>@core<br>@scientifice<br><span class="hljs-meta">%</span><span class="bash">end</span><br><br><span class="hljs-meta">#</span><span class="bash">修改centos7-ks.cfg权限文件</span><br>chmod 644 /var/www/html/ks/centos7-ks.cfg<br><br>vi /var/lib/tftpboot/pxelinux.cfg/default<br><br>timeout 100<br>default menu.c32<br>menu title ########## PXE Boot Menu ##########<br>label 1<br>   menu label ^1) Install CentOS 7<br>   kernel centos7/vmlinuz<br><span class="hljs-meta">   #</span><span class="bash"> 设置ks文件内容</span><br>   append initrd=centos7/initrd.img ks=http://10.0.0.30/ks/centos7-ks.cfg<br>label 2<br>   menu label ^2) Boot from local drive<br>   localboot<br></code></pre></td></tr></table></figure>

<p>2.可以通过system-config-kickstart命令执行图形界面来生成ks.cfg文件，与安装系统方式类似</p>
<div id="paginator"></div></div><div id="post-footer"><hr><a href="/2020/10/29/Centos-DHCP%E6%9C%8D%E5%8A%A1%E8%AE%BE%E7%BD%AE/">← Prev Centos-DHCP服务设置</a><span style="color: #fe2"> | </span><a href="/2020/10/22/%E8%AE%A1%E7%AE%97%E6%9C%BA%E9%80%BB%E8%BE%91/">计算机逻辑 Next →</a><hr></div><div id="bottom-btn"><a id="to-index" href="#post-index" title="index">≡</a><a id="to-top" href="#post-title" title="to top">∧</a></div><details id="reward"><summary>打赏</summary><div id="alipay"><span>支付宝 | Alipay</span><br><img src="/img/Alipay.png"></div><div id="wechat"><span>微信 | WeChat</span><br><img src="/img/WeChat.png"></div></details><div id="Valine"></div><script>new Valine({
 el: '#Valine'
 , appId: ''
 , appKey: ''
 , placeholder: '此条评论委托企鹅物流发送'
})</script></div></article><aside><div id="about"><a href="/" id="logo"><img src="/img/logo.png" alt="Logo"></a><h1 id="Dr"><a href="/"> Dr.Cokkid</a></h1><section id="total"><a id="total-archives" href="/archives"><span class="total-title">Archives Total:</span><span class="total-number">21</span></a><div id="total-tags"><span class="total-title">Tags:</span><span class="total-number">8</span></div><div id="total-categories"><span class="total-title">Categories:</span><span class="total-number">2</span></div></section></div><div id="aside-block"><h1>INDEX</h1><div id="post-index"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PXE"><span class="toc-number">1.1.</span> <span class="toc-text">PXE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PXE%E5%B7%A5%E4%BD%9C%E8%BF%87%E7%A8%8B"><span class="toc-number">1.2.</span> <span class="toc-text">PXE工作过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PXE%E7%BD%91%E7%BB%9C%E5%AE%89%E8%A3%85"><span class="toc-number">1.3.</span> <span class="toc-text">PXE网络安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kickstart%E8%87%AA%E5%8A%A8%E5%AE%89%E8%A3%85"><span class="toc-number">1.4.</span> <span class="toc-text">Kickstart自动安装</span></a></li></ol></li></ol></div></div><footer><nobr><span class="text-title">©</span><span class="text-content">1970 to 2020</span></nobr><wbr><nobr><span class="text-title">ICP</span><span class="text-content">——备案号——</span></nobr><wbr><wbr><nobr>published with&nbsp;<a target="_blank" rel="noopener" href="http://hexo.io">Hexo&nbsp;</a></nobr><wbr><nobr>Theme&nbsp;<a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknight&nbsp;</a></nobr><wbr><nobr>by&nbsp;<a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/arknights.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.1.2/highlight.min.js"></script></body></html>